<div class="places-page">
  <!-- Hero Section -->
  <section class="places-hero-section">
    <div class="places-hero-content">
      <h1 class="places-hero-title">Explore <%= @city.name %></h1>
      <%# <p class="places-hero-subtitle">Discover amazing places and hidden gems</p> %>

      <!-- Search Bar -->
      <div class="search-container">
        <%= form_with url: city_places_path(@city), method: :get, local: true, class: "places-search-form" do |f| %>
          <div class="places-search-wrapper">
            <%= f.text_field :query, value: params[:query], placeholder: "Search places...", class: "places-search-input" %>
            <%= f.button type: "submit", class: "places-search-btn" do %>
              <i class="fa-solid fa-magnifying-glass"></i>
            <% end %>
          </div>
          <% if params[:query].present? %>
            <%= link_to city_places_path(@city), class: "clear-search-btn" do %>
              <i class="fa-solid fa-xmark"></i> Clear
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  </section>

  <!-- Places Section -->
  <section class="places-section">
    <% if params[:query].present? %>
      <div class="section-header">
        <h2 class="section-title">Search results for "<%= params[:query] %>"</h2>
        <p class="section-subtitle"><%= @places.count %> place<%= @places.count == 1 ? '' : 's' %> found</p>
      </div>
    <% else %>
      <div class="section-header">
        <h2 class="section-title"></h2>
      </div>
    <% end %>

    <% if @places.any? %>
      <div class="places-grid">
        <% @places.each_with_index do |place, index| %>
          <% photos = place.comments.flat_map { |c| c.photos.to_a }.first(5) %>
          <div class="place-card <%= 'featured' if index < 2 %>">
            <% if photos.any? %>
              <div id="placeCardCarousel<%= place.id %>" class="carousel slide card-carousel" data-bs-ride="carousel">
                <div class="carousel-inner">
                  <% photos.each_with_index do |photo, photo_index| %>
                    <div class="carousel-item <%= 'active' if photo_index == 0 %>">
                      <div class="card-image" style="background-image: url('<%= cl_image_path photo.key, height: 400, width: 600, crop: :fill %>');"></div>
                    </div>
                  <% end %>
                </div>
                <% if photos.size > 1 %>
                  <button class="carousel-control-prev" type="button" data-bs-target="#placeCardCarousel<%= place.id %>" data-bs-slide="prev" onclick="event.stopPropagation();">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#placeCardCarousel<%= place.id %>" data-bs-slide="next" onclick="event.stopPropagation();">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  </button>
                  <div class="carousel-indicators-dots">
                    <% photos.each_with_index do |_, dot_index| %>
                      <span class="dot <%= 'active' if dot_index == 0 %>" data-bs-target="#placeCardCarousel<%= place.id %>" data-bs-slide-to="<%= dot_index %>"></span>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% elsif place.default_img_url %>
              <div class="card-image" style="background-image: url('<%= place.default_img_url %>');"></div>
            <% else %>
              <div class="card-image" style="background-image: url('https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800');"></div>
            <% end %>
            <div class="card-overlay"></div>
            <%= link_to city_place_path(place.city, place), class: "card-link" do %>
              <div class="card-content">
                <h3 class="card-title"><%= place.title %></h3>
                <span class="card-cta">View details<i class="fa-solid fa-arrow-right"></i></span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="no-results">
        <i class="fa-solid fa-compass fa-3x mb-3 text-muted"></i>
        <p class="text-muted">No places found<%= " for \"#{params[:query]}\"" if params[:query].present? %></p>
        <% if params[:query].present? %>
          <%= link_to "View all places", city_places_path(@city), class: "btn btn-outline-primary mt-2" %>
        <% end %>
      </div>
    <% end %>
  </section>
</div>

<div class="auth-page">
  <div class="auth-phone-shell">
    <div class="auth-card">
      <header class="auth-header">
        <div class="auth-title-row">
          <span class="auth-title-main">Edit Profile</span>
        </div>
        <p class="auth-subtitle">Update your account settings</p>
      </header>

    <%= simple_form_for(resource,
                    as: resource_name,
                    url: registration_path(resource_name),
                    html: { method: :put, class: "auth-form", multipart: true }) do |f| %>

        <%= f.error_notification %>

        <!-- Avatar Upload -->

        <div class="auth-avatar-section">
          <div class="auth-avatar-preview">
           <% if resource.persisted? && resource.avatar.attached? %>
    <%= image_tag url_for(resource.avatar), class: "auth-avatar-img" %>
    <% else %>
      <div class="auth-avatar-placeholder">
      <%= resource.username&.first&.upcase || resource.email.first.upcase %>
     </div>
    <% end %>
          </div>
          <div class="auth-avatar-upload">
            <%= f.label :avatar, class: "auth-avatar-btn" do %>
              <i class="fa-solid fa-camera"></i>
              Change Photo
            <% end %>
            <%= f.file_field :avatar, class: "auth-avatar-input", accept: "image/*", direct_upload: true %>
          </div>
        </div>

        <div class="auth-field-group">
          <%= f.label :username, "Username", class: "auth-label" %>
          <%= f.input :username,
                      label: false,
                      required: false,
                      input_html: {
                        class: "auth-input-field",
                        placeholder: "Your display name"
                      } %>
        </div>

        <div class="auth-field-group">
          <%= f.label :city, "City", class: "auth-label" %>
          <%= f.input :city,
                      label: false,
                      required: false,
                      input_html: {
                        class: "auth-input-field",
                        placeholder: "Where are you from?"
                      } %>
        </div>

        <div class="auth-field-group">
          <%= f.label :email, "Email", class: "auth-label" %>
          <%= f.input :email,
                      label: false,
                      required: true,
                      autofocus: true,
                      input_html: {
                        autocomplete: "email",
                        class: "auth-input-field"
                      } %>

          <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
            <p class="auth-hint">Currently waiting confirmation for: <%= resource.unconfirmed_email %></p>
          <% end %>
        </div>

        <div class="auth-separator">
          <span class="auth-separator-line"></span>
          <span class="auth-separator-text">Change Password</span>
          <span class="auth-separator-line"></span>
        </div>

        <div class="auth-field-group">
          <%= f.label :password, "New Password", class: "auth-label" %>
          <%= f.input :password,
                      label: false,
                      hint: false,
                      required: false,
                      input_html: {
                        autocomplete: "new-password",
                        class: "auth-input-field",
                        placeholder: "Leave blank to keep current"
                      } %>
        </div>

        <div class="auth-field-group">
          <%= f.label :password_confirmation, "Confirm New Password", class: "auth-label" %>
          <%= f.input :password_confirmation,
                      label: false,
                      required: false,
                      input_html: {
                        autocomplete: "new-password",
                        class: "auth-input-field"
                      } %>
        </div>

        <div class="auth-separator">
          <span class="auth-separator-line"></span>
          <span class="auth-separator-text">Confirm Changes</span>
          <span class="auth-separator-line"></span>
        </div>

        <div class="auth-field-group">
          <%= f.label :current_password, "Current Password", class: "auth-label" %>
          <%= f.input :current_password,
                      label: false,
                      hint: false,
                      required: true,
                      input_html: {
                        autocomplete: "current-password",
                        class: "auth-input-field",
                        placeholder: "Required to save changes"
                      } %>
        </div>

        <div class="auth-actions">
          <%= f.button :submit, "Save Changes", class: "auth-primary-btn" %>
        </div>
      <% end %>

      <div class="auth-footer-links">
        <%= link_to "Back to Profile", user_path(current_user) %>
      </div>

      <div class="auth-danger-zone">
        <p class="auth-danger-title">Danger Zone</p>
        <%= button_to "Delete Account", registration_path(resource_name),
            method: :delete,
            data: { confirm: "Are you sure? This cannot be undone.", turbo_confirm: "Are you sure? This cannot be undone." },
            class: "auth-danger-btn" %>
      </div>

    </div>
  </div>
</div>

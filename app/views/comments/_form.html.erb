<div class="card shadow-sm border-0 rounded-4">
  <div class="card-body p-4">
    <%= simple_form_for comment, html: { class: "comment-form" } do |f| %>
      <% if local_assigns[:place]&.new_record? %>
        <h4 class="mb-4 text-primary"><i class="fas fa-map-marker-alt me-2"></i>Add a New Place</h4>

        <%= simple_fields_for :place, place do |p| %>
          <div class="row">
            <div class="col-md-6 mb-3">
              <%= p.input :title,
                label: "Place Name",
                placeholder: "e.g. Sagrada Familia",
                input_html: { class: "form-control form-control-lg rounded-3" } %>
            </div>
            <div class="col-md-6 mb-3">
              <%= p.input :city_id,
                collection: City.all,
                label: "City",
                prompt: "Select a city",
                input_html: { class: "form-select form-select-lg rounded-3" } %>
            </div>
          </div>

          <div class="mb-3" data-controller="address-autocomplete" data-address-autocomplete-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
            <label class="form-label fw-semibold">Address</label>
            <div class="geocoder-container rounded-3"></div>
            <%= p.input :address, as: :hidden, input_html: { data: { address_autocomplete_target: "address" } } %>
            <%= p.input :latitude, as: :hidden, input_html: { data: { address_autocomplete_target: "latitude" } } %>
            <%= p.input :longitude, as: :hidden, input_html: { data: { address_autocomplete_target: "longitude" } } %>
          </div>
        <% end %>

        <hr class="my-4">
      <% end %>

      <h4 class="mb-4 text-primary"><i class="fas fa-comment me-2"></i>Your Experience</h4>

      <div class="mb-3">
        <%= f.input :description,
          as: :text,
          label: "Share your experience",
          placeholder: "Tell others about your visit... What made it special? Any tips for future visitors?",
          input_html: { class: "form-control rounded-3", rows: 5 } %>
        <div class="form-text">Minimum 100 characters</div>
      </div>

      <div class="mb-4">
        <%= f.input :photos,
          as: :file,
          direct_upload: true,
          label: "Upload Photos",
          input_html: { multiple: true, class: "form-control rounded-3", accept: "image/*" } %>
        <div class="form-text"><i class="fas fa-camera me-1"></i>Share your best shots (optional)</div>
      </div>

      <div class="d-grid">
        <%= f.submit local_assigns[:place]&.new_record? ? "Create Place & Comment" : "Add Comment",
          class: "btn btn-primary btn-lg rounded-3 py-3" %>
      </div>
    <% end %>
  </div>
</div>
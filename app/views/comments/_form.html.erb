<div class="comment-form-wrapper">
  <div class="comment-form-card">
    <%= simple_form_for comment, html: { class: "styled-comment-form" } do |f| %>
      <% if local_assigns[:place]&.new_record? %>
        <div class="form-section">
          <h3 class="form-section-title">
            <i class="fa-solid fa-location-dot"></i>
            Add a New Place
          </h3>

          <%= simple_fields_for :place, place do |p| %>
            <div data-controller="address-autocomplete" data-address-autocomplete-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
              <div class="form-field">
                <%= p.input :title,
                  label: "Place Name",
                  placeholder: "e.g. Sagrada Familia",
                  input_html: { class: "styled-input" } %>
              </div>

              <div class="form-field">
                <%= p.input :city_id,
                  collection: City.order(:name),
                  label: "City",
                  prompt: "Select a city first",
                  input_html: {
                    class: "styled-select",
                    data: { address_autocomplete_target: "citySelect", action: "change->address-autocomplete#cityChanged" }
                  } %>
              </div>

              <div class="form-field">
                <label class="styled-label">Address</label>
                <div class="geocoder-container" data-address-autocomplete-target="geocoderContainer"></div>
                <p class="form-hint" data-address-autocomplete-target="addressHint">
                  <i class="fa-solid fa-circle-info"></i> Please select a city first
                </p>
                <%= p.input :address, as: :hidden, input_html: { data: { address_autocomplete_target: "address" } } %>
                <%= p.input :latitude, as: :hidden, input_html: { data: { address_autocomplete_target: "latitude" } } %>
                <%= p.input :longitude, as: :hidden, input_html: { data: { address_autocomplete_target: "longitude" } } %>
              </div>
            </div>
          <% end %>
        </div>

        <div class="form-divider"></div>
      <% end %>

      <div class="form-section">
        <h3 class="form-section-title">
          <i class="fa-solid fa-pen-to-square"></i>
          Your Experience
        </h3>

        <div class="form-field">
          <%= f.input :description,
            as: :text,
            label: "Share your experience",
            placeholder: "Tell others about your visit... What made it special? Any tips for future visitors?",
            input_html: { class: "styled-textarea", rows: 5 } %>
          <p class="form-hint">Minimum 20 characters</p>
        </div>

        <div class="form-field">
          <%= f.input :photos,
            as: :file,
            direct_upload: true,
            label: "Upload Photos",
            input_html: { multiple: true, class: "styled-file-input", accept: "image/*" } %>
          <p class="form-hint">
            <i class="fa-solid fa-camera"></i> Share your best shots (optional)
          </p>
        </div>
      </div>

      <div class="form-actions">
        <%= f.submit local_assigns[:place]&.new_record? ? "Create Place & Comment" : "Add Comment",
          class: "btn-submit-form" %>
      </div>
    <% end %>
  </div>
</div>